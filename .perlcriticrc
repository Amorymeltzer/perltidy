severity = 1

# Some useful links:
# https://manpages.ubuntu.com/manpages/xenial/man1/perlcritic.1p.html
# https://perlmaven.com/perl-critic

verbose = %f: [%p] %m at line %l, column %c.\n

# Example command to run a single policy on single module:
# perlcritic --single-policy Subroutines::ProhibitSubroutinePrototypes Module.pm

#--------------------------------------------------------------
# Following is a list of policies to be skipped for severity=4:
#--------------------------------------------------------------

# There is a localization in Tokenizer.pm that is essential
[-Variables::ProhibitLocalVars] 

# Immediate initialization of locals is not appropriate where used
# in the Tokenizer.pm module
[-Variables::RequireInitializationForLocalVars] 

# There is a stringy eval in Formatter.pm which is essential.  
[-BuiltinFunctions::ProhibitStringyEval] 

# Tidy.pm exports 'perltidy'. Changing this could break existing scripts.
[-Modules::ProhibitAutomaticExportation]

# 'print' and 'close' homonyms are appropriate where they are used.
[-Subroutines::ProhibitBuiltinHomonyms]

# Nested subs are needed for error handling in Tidy.pm. 
[-Subroutines::ProhibitNestedSubs]

# In critical routines this can significantly reduce processing speed.
[-Subroutines::RequireArgUnpacking]

# Disagree. The advantages of 'use constant' significantly outweigh the
# disadvantages.  Perl::Tidy uses constants for efficient and robust coding of
# array indexes and debug code.
[-ValuesAndExpressions::ProhibitConstantPragma]

# Disagree: adding quotes on here doc terminators causes needless
# "line noise" in the source code.  Almost always the default works.  My editor
# uses color to make it clear if interpolation is in effect.
[-ValuesAndExpressions::RequireQuotedHeredocTerminator]

# Perlcritic doesn't know ARGV actually is localized.
[-Variables::RequireLocalizedPunctuationVars]

#--------------------------------------------------------------
# Following is a list of policies to be skipped for severity=3:
#--------------------------------------------------------------

# AUTOLOAD is only used in perltidy to help find and debug programming errors.
[-ClassHierarchies::ProhibitAutoloading]

# TBD: These are both good policies but they can be very hard to
# avoid without a significant loss of efficiency.  So they are excluded here
# but they should be run as --single-policy from time to time to see if
# improvements can be made.
[-Subroutines::ProhibitExcessComplexity]
[-ControlStructures::ProhibitDeepNests]

# The if-elsif sequences in perltidy have all been profiled and
# are fine as is. Changing them would complicate the code without
# any benefit in reduced run time.
[-ControlStructures::ProhibitCascadingIfElse]

# Agree in general but sometimes an 'unless' is just clearer than an 'if'
[-ControlStructures::ProhibitNegativeExpressionsInUnlessAndUntilConditions]

# PerlCritic doesn't seem to recognize when $@ is checked
[-ErrorHandling::RequireCheckingReturnValueOfEval] 

# This is a good general policy but not always the best for efficiency
[-Subroutines::ProhibitManyArgs]

[-ClassHierarchies::ProhibitExplicitISA]

# These are okay where used
[-NamingConventions::ProhibitAmbiguousNames]

# I find that using lvalue substr much clearer than adding another arg to
# substr.  So skip this.
[-BuiltinFunctions::ProhibitLvalueSubstr]

# The Tokenizer.pm needs package variables
[-Variables::ProhibitPackageVars]

# Do not change any debugged regular expressions without good reason
[-RegularExpressions::RequireExtendedFormatting]
[-RegularExpressions::ProhibitComplexRegexes]
[-RegularExpressions::ProhibitUnusedCapture]
[-RegularExpressions::ProhibitCaptureWithoutTest]

#--------------------------------------------------------------
# Following is a list of policies to be skipped for severity=2:
#--------------------------------------------------------------

# Disagree. In fact, following this policy caused a parsing error in Perl
# version 5.14 at file test operators.
[-BuiltinFunctions::ProhibitUselessTopic]

# Do not change any debugged regular expressions without good reason
[-RegularExpressions::RequireDotMatchAnything]
[-RegularExpressions::RequireLineBoundaryMatching]

# Disagree. Is '#' really harder to read than q{#}?
[-ValuesAndExpressions::ProhibitNoisyQuotes]

# In some cases a postfix control shows the logical flow best
[-ControlStructures::ProhibitPostfixControls]

# Sometimes an unless block is clearer than an if block
[-ControlStructures::ProhibitUnlessBlocks]

# The very few instances of boolean grep are fine. Profiling shows that
# changing them would not result in a measureable improvement in speed. 
[-BuiltinFunctions::ProhibitBooleanGrep] 

# The only escaped characters in Perl::Tidy are in code for detecting and
# setting line endings ( CR and LF ).  This is fully debugged coding and 
# best left unchanged.
[-ValuesAndExpressions::ProhibitEscapedCharacters] 

# These have been checked. This is a good idea but has to be turned off because
# there are many cases where a number has been explained in a comment or is
# obvious.
[-ValuesAndExpressions::ProhibitMagicNumbers]

#--------------------------------------------------------------
# Following is a list of policies to be skipped for severity=1:
#--------------------------------------------------------------

# This is a good starting rule but occasional capitalization can be quite
# effective, so we have to ignore it as a general rule:
[-NamingConventions::Capitalization]

# It would be nice if this option were configurable to skip STDERR and STDOUT
# which are used by perltidy for debug statements.  I don't think {*STDOUT} is
# preferable to simply STDOUT. So we have to skip it.
[-InputOutput::RequireBracedFileHandleWithPrint]

# PerlCritic should not suggest this policy for complex sorts because it can
# change program behavior.  And it does not even make sense for sorts on
# multiple keys, like this one which got flagged in Perl::Tidy
#        @candidates =
#          sort { $b->[1] <=> $a->[1] || $a->[0] <=> $b->[0] } @candidates;
# Changing the first part requires changing the second part, so either way
# you have a comparison of the form $b->[*] <=> $a->[*]. 
[-BuiltinFunctions::ProhibitReverseSortBlock]

# Do not change any debugged regular expressions without good reason
[-RegularExpressions::ProhibitEscapedMetacharacters]
[-RegularExpressions::ProhibitEnumeratedClasses]
[-RegularExpressions::ProhibitUnusualDelimiters]
[-RegularExpressions::ProhibitSingleCharAlternation]
[-RegularExpressions::RequireBracesForMultiline]
[-RegularExpressions::ProhibitSingleCharAlternation]

# Disagree. Double quotes are easier to read than single quotes and allow a
# uniform style for quotes.  My editor has color coding which indicates
# interpolation. Double quotes do not increase processing time by any
# measurable amount.  Using them as default simplfies making editing changes.
# So skip this:
[-ValuesAndExpressions::ProhibitInterpolationOfLiterals]

# These have been checked and are correct as written 
[-ValuesAndExpressions::RequireInterpolationOfMetachars]

# Disagree: parens can add clarity and may even be essential.
# There is little to be gained by omitting them.
[-CodeLayout::ProhibitParensWithBuiltins] 

# This is OK if we exclude 'print'
[InputOutput::RequireCheckedSyscalls]
exclude_functions = print
